<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta name="description" content="">
    <meta name="keywords" content="">

    <!-- CSS links (Bootstrap, icons, etc.) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Arsenal+SC:ital,wght@0,400;0,700;1,400;1,700&family=DM+Serif+Text:ital@0;1&family=News+Cycle:wght@400;700&family=Newsreader:opsz,wght@6..72,700&family=Quicksand:wght@300..700&display=swap"
        rel="stylesheet">
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="vendor/aos/aos.css" rel="stylesheet">
    <link href="vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
    <link href="css/main.css" rel="stylesheet">

    <!-- Styling -->
    <style>
        .technician {
            background-color: #e9ecef;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .technician:hover {
            background-color: #d4d8db;
        }

        .phone-number {
            margin-top: 5px;
            color: #007bff;
            display: none;
            font-weight: bold;
        }

        .info {
            margin-top: 5px;
            display: none;
        }
    </style>

    <title>YallaFix - Finding a Tech</title>
</head>

<body>
    <!-- Global header -->
    <header id="header" class="header d-flex align-items-center sticky-top">
        <div class="container-fluid container-xl position-relative d-flex align-items-center justify-content-between">
            <a href="index.html" class="logo d-flex align-items-center">
                <h1 class="sitename"><span>Y</span>alla<span>F</span>ix</h1>
            </a>

            <nav id="navmenu" class="navmenu">
                <ul>
                    <li><a href="index.html" class="active">Home</a></li>
                    <li><a href="index.html#about">About</a></li>
                    <li><a href="index.html#services">Services</a></li>
                    <li><a href="index.html#contact">Contact</a></li>
                </ul>
                <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
            </nav>
        </div>
    </header>
    <!-- End of Global header -->

    <main class="main">

        <!-- Page Title -->
        <div class="page-title" data-aos="fade">
            <div class="heading">
                <div class="container">
                    <div class="row d-flex justify-content-center text-center">
                        <div class="col-lg-8">
                            <h1>Finding A Technician</h1>
                            <p class="mb-0">Click on the technician for contact information.</p>
                        </div>
                    </div>
                </div>
            </div>

            <nav class="breadcrumbs">
                <div class="container">
                    <ol>
                        <li><a href="index.html">Home</a></li>
                        <li class="current">Finding A Technician</li>
                    </ol>
                </div>
            </nav>
        </div>
        <!-- End Page Title -->

        <!-- Technician list -->
        <div class="container" style="margin-top: 5%; margin-bottom: 5%;">
            <h2>Available Technicians</h2>
            <div id="technicianList">
                <!-- Technician list will be generated here -->
            </div>
        </div>
        <!-- End of Technician list -->

    </main>

    <!-- Global footer -->
    <footer id="footer" class="footer light-background">
        <div class="container">
            <div class="copyright text-center">
                <p>Â© <span>Copyright</span>
                    <strong class="px-1 sitename">YallaFix</strong>
                    <span>All Rights Reserved</span>
                </p>
            </div>

            <div class="social-links d-flex justify-content-center">
                <a href=""><i class="bi bi-twitter-x"></i></a>
                <a href=""><i class="bi bi-facebook"></i></a>
                <a href=""><i class="bi bi-instagram"></i></a>
                <a href=""><i class="bi bi-linkedin"></i></a>
            </div>
            <div class="credits">
                Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
            </div>
        </div>
    </footer>
    <!-- End of Global footer -->

    <!-- Scroll -->
    <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center">
        <i class="bi bi-arrow-up-short"></i>
    </a>

    <!-- Vendor JS Files -->
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="vendor/aos/aos.js"></script>
    <script src="vendor/glightbox/js/glightbox.min.js"></script>
    <script src="js/main.js"></script>
    <!-- <script src="js/script2.js"></script> -->

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-auth.js";
      
        const firebaseConfig = {
            apiKey: "AIzaSyAZlaYBlGK1pT6ug_4JfLYNE3uLEuh7U7o",
            authDomain: "yallafix-8586f.firebaseapp.com",
            projectId: "yallafix-8586f",
            storageBucket: "yallafix-8586f.firebasestorage.app",
            messagingSenderId: "68556947912",
            appId: "1:68556947912:web:8d07a7c75d1652f81d00fd",
            measurementId: "G-E2BJQZQWGD"
        };
      
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
      
        const service = localStorage.getItem("selectedService");
      
        onAuthStateChanged(auth, async (user) => {
          if (user) {
            const uid = user.uid;
      
            // Send request to backend to find matching technicians
            const res = await fetch(`/findTechnicians?uid=${uid}&service=${encodeURIComponent(service)}`);
            const technicians = await res.json();
            displayTechnicians(technicians);
          } else {
            alert("You must be logged in to find a technician.");
            window.location.href = "login.html";
          }
        });
      
        function displayTechnicians(technicians) {
          const technicianList = document.getElementById("technicianList");
          technicianList.innerHTML = "";
      
          if (technicians.length === 0) {
            technicianList.innerHTML = "<p>No technicians found matching your location and service.</p>";
            return;
          }
      
          technicians.forEach(tech => {
            const techDiv = document.createElement("div");
            techDiv.className = "technician";
            techDiv.innerHTML = `
              <strong>${tech.name}</strong> - ${tech.task}
              <div class="phone-number">ðŸ“ž ${tech.phone}</div>
              <div class="info">Experience: ${tech.expertise_level} - Pricing: ${tech.min_price} - ${tech.max_price} </div>
            `;
      
            techDiv.addEventListener("click", () => {
              techDiv.querySelector(".phone-number").style.display = "block";
              techDiv.querySelector(".info").style.display = "block";
            });
      
            technicianList.appendChild(techDiv);
          });
        }
      </script>
      

</body>

</html>